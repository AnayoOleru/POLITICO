'use strict';

var token = window.localStorage.getItem('token');
var payload = JSON.parse(window.atob(token.split('.')[1]));

function verifyToken() {
  if (!token) {
    window.location.href = '/views/sign-in.html';
  }
  // check if user is not an admin
  if (payload.isAdmin == false) {
    window.location.href = '/views/sign-in.html';
  }
}

var sideNav = document.getElementById('mySidenav');
var openParty = document.getElementById('openparty');
var addbtn = document.getElementById('addbtn');
var editBtn = document.getElementById('edit');
var deleteParty = document.getElementById('deleteparty');
var deleteBtn = document.getElementById('delete');
var openModal = document.getElementById('openmodal');

function openNav() {
  sideNav.style.width = '250px';
}

function closeNav() {
  sideNav.style.width = '0';
}

// add party

function openLog() {
  openModal.style.display = 'block';
  editBtn.disabled = true;
  deleteBtn.disabled = true;
}

function closeLog() {
  openModal.style.display = 'none';
  editBtn.disabled = false;
  deleteBtn.disabled = false;
}

// delete party
// deleteBtn.addEventListener("click", openDelete)
function openDelete() {
  deleteParty.style.display = 'block';
  addbtn.disabled = true;
  editBtn.disabled = true;
}

function closeDelete() {
  deleteParty.style.display = 'none';
  addbtn.disabled = false;
  editBtn.disabled = false;
}

// consuming API
// admin can create party
document.getElementById('addParty').addEventListener('submit', addParty);

function addParty(e) {
  e.preventDefault();

  var name = document.getElementById('name').value;
  var hqaddress = document.getElementById('hqaddress').value;
  var logoUrl = document.getElementById('logoURL').value;
  var result = document.getElementById('result');
  var responseStatus = false;

  fetch('https://trustpolitico.herokuapp.com/api/v1/parties', {
    method: 'POST',
    headers: {
      Accept: 'application/json, text/plain, */*',
      'Content-type': 'application/json',
      'x-access-token': token
    },
    body: JSON.stringify({
      name: name,
      hqaddress: hqaddress,
      logoUrl: logoUrl
    })

  }).then(function (res) {
    if (res.ok) {
      responseStatus = true;
      result.innerHTML = 'party successfully created';
      result.style.color = 'white';
    }
    return res.json();
  })
  // render the parties page
  .then(function (res) {
    console.log(res);
    if (!responseStatus) {
      result.innerHTML = res.error;
      result.style.color = 'White';
    }
    if (res.data[0].user.isadmin == true) {
      window.location.href = '/views/signin.html';
    }
  });
}

function getParties() {
  fetch('https://trustpolitico.herokuapp.com/api/v1/parties', {
    method: 'GET',
    headers: {
      Accept: 'application/json, text/plain, */*',
      'Content-type': 'application/json',
      'x-access-token': token
    }
  }).then(function (res) {
    return res.json();
  }).then(function (data) {
    console.log(data);
    var result = '';
    data.data.forEach(function (party) {
      result += '<div class="col-1-of-3">\n                <div class="card">\n                    <div class="card__side card__side--front">\n                        <div class="card__picture card__picture--1" id="partyImage">&nbsp;</div>\n                        <div class="card__details">\n                            <ul>\n                                <li style="font-size: 30px" class="partyId" id=' + party.id + '>' + party.name + '</li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div class="card__side card__side--back card__side--back-1">\n                        <div class="card__cta">\n                            <div class="card__price-box">\n                                <p class="card__price-only">Headquater Address</p>\n                                <p class="card__price-only" id="partyAddress">' + party.hqaddress + '</p>\n                            </div>\n                            <a href="#" class="btn" id="edit" onclick="openEdit(\'' + party.id + '\')">Edit</a>\n                            <a href="#" class="btn" id="delete" onclick="openDelete()">Delete</a>\n                        </div>\n                    </div>\n                </div>\n            </div> ';

      username = '<li><a href="#" class="active">' + payload.userName + ' ' + payload.lastName + '</a></li>';

      nameside = '<span>' + payload.userName + ' ' + payload.lastName + '</span>';
    });
    document.getElementById('partyResult').innerHTML = result;
    document.getElementById('username').innerHTML = username;
    document.getElementById('nameside').innerHTML = nameside;
  });
}

getParties();

function openEdit(party) {
  openParty.style.display = 'block';
  openParty.dataset.partyId = party;
  addbtn.disabled = true;
}

function closeEdit() {
  openParty.style.display = 'none';
  deleteBtn.disabled = false;
  addbtn.disabled = false;
}
var responseStatus = false;
var result = document.getElementById('result');

function editSubmit() {
  var Id = openParty.dataset.partyId;
  var name = document.getElementById('editvalue').value;

  fetch('https://trustpolitico.herokuapp.com/api/v1/parties/' + Id + '/name', {
    method: 'PATCH',
    headers: {
      Accept: 'application/json, text/plain, */*',
      'Content-type': 'application/json',
      'x-access-token': token
    },
    body: JSON.stringify({
      name: name
    })

  }).then(function (res) {
    if (res.ok) {
      responseStatus = true;
      delResult.innerHTML = 'Candidate name had changed';
      delResult.style.color = 'white';
      closeEdit();
    }
    return res.json();
  })
  // render the parties page
  .then(function (res) {
    console.log(res);
    if (!responseStatus) {
      delResult.innerHTML = res.error;
      delResult.style.color = 'red';
    }
    if (payload.isadmin == false) {
      window.location.href = '/views/signin.html';
    }
  });
}

// delete party
var delResult = document.getElementById('delResult');

function deleteGo() {
  var Id = openParty.dataset.partyId;

  fetch('https://trustpolitico.herokuapp.com/api/v1/parties/' + Id, {
    method: 'DELETE',
    headers: {
      Accept: 'application/json, text/plain, */*',
      'Content-type': 'application/json',
      'x-access-token': token
    }
  }).then(function (res) {
    if (res.ok) {
      responseStatus = true;
      result.innerHTML = 'Candidate name had changed';
      result.style.color = 'green';
      closeEdit();
    }
    console.log(res);
    return res.json();
  })
  // render the parties page
  .then(function (res) {
    console.log(res);
    if (!responseStatus) {
      result.innerHTML = res.error;
      result.style.color = 'red';
    }
    if (payload.isadmin == false) {
      window.location.href = '/views/signin.html';
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL1VJL3NjcmlwdHMvYWRkcGFydGllcy5qcyJdLCJuYW1lcyI6WyJ0b2tlbiIsIndpbmRvdyIsInBheWxvYWQiLCJKU09OIiwic2lkZU5hdiIsImRvY3VtZW50Iiwib3BlblBhcnR5IiwiYWRkYnRuIiwiZWRpdEJ0biIsImRlbGV0ZVBhcnR5IiwiZGVsZXRlQnRuIiwib3Blbk1vZGFsIiwiZSIsIm5hbWUiLCJocWFkZHJlc3MiLCJsb2dvVXJsIiwicmVzdWx0IiwicmVzcG9uc2VTdGF0dXMiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBY2NlcHQiLCJib2R5IiwicmVzIiwiY29uc29sZSIsImRhdGEiLCJwYXJ0eSIsInVzZXJuYW1lIiwibmFtZXNpZGUiLCJnZXRQYXJ0aWVzIiwiSWQiLCJkZWxSZXN1bHQiLCJjbG9zZUVkaXQiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEsUUFBUUMsT0FBQUEsWUFBQUEsQ0FBQUEsT0FBQUEsQ0FBZCxPQUFjQSxDQUFkO0FBQ0EsSUFBTUMsVUFBVUMsS0FBQUEsS0FBQUEsQ0FBV0YsT0FBQUEsSUFBQUEsQ0FBWUQsTUFBQUEsS0FBQUEsQ0FBQUEsR0FBQUEsRUFBdkMsQ0FBdUNBLENBQVpDLENBQVhFLENBQWhCOztBQUVBLFNBQUEsV0FBQSxHQUF1QjtBQUNyQixNQUFJLENBQUosS0FBQSxFQUFZO0FBQ1ZGLFdBQUFBLFFBQUFBLENBQUFBLElBQUFBLEdBQUFBLHFCQUFBQTtBQUNEO0FBQ0Q7QUFDQSxNQUFJQyxRQUFBQSxPQUFBQSxJQUFKLEtBQUEsRUFBOEI7QUFDNUJELFdBQUFBLFFBQUFBLENBQUFBLElBQUFBLEdBQUFBLHFCQUFBQTtBQUNEO0FBQ0Y7O0FBR0QsSUFBTUcsVUFBVUMsU0FBQUEsY0FBQUEsQ0FBaEIsV0FBZ0JBLENBQWhCO0FBQ0EsSUFBTUMsWUFBWUQsU0FBQUEsY0FBQUEsQ0FBbEIsV0FBa0JBLENBQWxCO0FBQ0EsSUFBTUUsU0FBU0YsU0FBQUEsY0FBQUEsQ0FBZixRQUFl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QUFBQSxJQUFBQSxDQW1CUSxVQUFBLEdBQUEsRUFBUztBQUNiTSxZQUFBQSxHQUFBQSxDQUFBQSxHQUFBQTtBQUNBLFFBQUksQ0FBSixjQUFBLEVBQXFCO0FBQ25CUixhQUFBQSxTQUFBQSxHQUFtQk8sSUFBbkJQLEtBQUFBO0FBQ0FBLGFBQUFBLEtBQUFBLENBQUFBLEtBQUFBLEdBQUFBLEtBQUFBO0FBQ0Q7QUFDRCxRQUFJZCxRQUFBQSxPQUFBQSxJQUFKLEtBQUEsRUFBOEI7QUFDNUJELGFBQUFBLFFBQUFBLENBQUFBLElBQUFBLEdBQUFBLG9CQUFBQTtBQUNEO0FBM0JMaUIsR0FBQUE7QUE2QkQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB0b2tlbiA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndG9rZW4nKTtcbmNvbnN0IHBheWxvYWQgPSBKU09OLnBhcnNlKHdpbmRvdy5hdG9iKHRva2VuLnNwbGl0KCcuJylbMV0pKTtcblxuZnVuY3Rpb24gdmVyaWZ5VG9rZW4oKSB7XG4gIGlmICghdG9rZW4pIHtcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvdmlld3Mvc2lnbi1pbi5odG1sJztcbiAgfVxuICAvLyBjaGVjayBpZiB1c2VyIGlzIG5vdCBhbiBhZG1pblxuICBpZiAocGF5bG9hZC5pc0FkbWluID09IGZhbHNlKSB7XG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3ZpZXdzL3NpZ24taW4uaHRtbCc7XG4gIH1cbn1cblxuXG5jb25zdCBzaWRlTmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ215U2lkZW5hdicpO1xuY29uc3Qgb3BlblBhcnR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZW5wYXJ0eScpO1xuY29uc3QgYWRkYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGJ0bicpO1xuY29uc3QgZWRpdEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlZGl0Jyk7XG5jb25zdCBkZWxldGVQYXJ0eSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWxldGVwYXJ0eScpO1xuY29uc3QgZGVsZXRlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZScpO1xuY29uc3Qgb3Blbk1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZW5tb2RhbCcpO1xuXG5mdW5jdGlvbiBvcGVuTmF2KCkge1xuICBzaWRlTmF2LnN0eWxlLndpZHRoID0gJzI1MHB4Jztcbn1cblxuZnVuY3Rpb24gY2xvc2VOYXYoKSB7XG4gIHNpZGVOYXYuc3R5bGUud2lkdGggPSAnMCc7XG59XG5cbi8vIGFkZCBwYXJ0eVxuXG5mdW5jdGlvbiBvcGVuTG9nKCkge1xuICBvcGVuTW9kYWwuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gIGVkaXRCdG4uZGlzYWJsZWQgPSB0cnVlO1xuICBkZWxldGVCdG4uZGlzYWJsZWQgPSB0cnVlO1xufVxuXG5mdW5jdGlvbiBjbG9zZUxvZygpIHtcbiAgb3Blbk1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gIGVkaXRCdG4uZGlzYWJsZWQgPSBmYWxzZTtcbiAgZGVsZXRlQnRuLmRpc2FibGVkID0gZmFsc2U7XG59XG5cbi8vIGRlbGV0ZSBwYXJ0eVxuLy8gZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvcGVuRGVsZXRlKVxuZnVuY3Rpb24gb3BlbkRlbGV0ZSgpIHtcbiAgZGVsZXRlUGFydHkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gIGFkZGJ0bi5kaXNhYmxlZCA9IHRydWU7XG4gIGVkaXRCdG4uZGlzYWJsZWQgPSB0cnVlO1xufVxuXG5mdW5jdGlvbiBjbG9zZURlbGV0ZSgpIHtcbiAgZGVsZXRlUGFydHkuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgYWRkYnRuLmRpc2FibGVkID0gZmFsc2U7XG4gIGVkaXRCdG4uZGlzYWJsZWQgPSBmYWxzZTtcbn1cblxuLy8gY29uc3VtaW5nIEFQSVxuLy8gYWRtaW4gY2FuIGNyZWF0ZSBwYXJ0eVxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZFBhcnR5JykuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgYWRkUGFydHkpO1xuXG5mdW5jdGlvbiBhZGRQYXJ0eShlKSB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZScpLnZhbHVlO1xuICBjb25zdCBocWFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaHFhZGRyZXNzJykudmFsdWU7XG4gIGNvbnN0IGxvZ29VcmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nb1VSTCcpLnZhbHVlO1xuICBjb25zdCByZXN1bHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0Jyk7XG4gIGxldCByZXNwb25zZVN0YXR1cyA9IGZhbHNlO1xuXG5cbiAgZmV0Y2goJ2h0dHBzOi8vdHJ1c3Rwb2xpdGljby5oZXJva3VhcHAuY29tL2FwaS92MS9wYXJ0aWVzJywge1xuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKicsXG4gICAgICAnQ29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgJ3gtYWNjZXNzLXRva2VuJzogdG9rZW4sXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBuYW1lLFxuICAgICAgaHFhZGRyZXNzLFxuICAgICAgbG9nb1VybCxcbiAgICB9KSxcblxuICB9KVxuICAgIC50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmVzcG9uc2VTdGF0dXMgPSB0cnVlO1xuICAgICAgICByZXN1bHQuaW5uZXJIVE1MID0gJ3BhcnR5IHN1Y2Nlc3NmdWxseSBjcmVhdGVkJztcbiAgICAgICAgcmVzdWx0LnN0eWxlLmNvbG9yID0gJ3doaXRlJztcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH0pXG4gICAgLy8gcmVuZGVyIHRoZSBwYXJ0aWVzIHBhZ2VcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgaWYgKCFyZXNwb25zZVN0YXR1cykge1xuICAgICAgICByZXN1bHQuaW5uZXJIVE1MID0gcmVzLmVycm9yO1xuICAgICAgICByZXN1bHQuc3R5bGUuY29sb3IgPSAnV2hpdGUnO1xuICAgICAgfVxuICAgICAgaWYgKHJlcy5kYXRhWzBdLnVzZXIuaXNhZG1pbiA9PSB0cnVlKSB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy92aWV3cy9zaWduaW4uaHRtbCc7XG4gICAgICB9XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldFBhcnRpZXMoKSB7XG4gIGZldGNoKCdodHRwczovL3RydXN0cG9saXRpY28uaGVyb2t1YXBwLmNvbS9hcGkvdjEvcGFydGllcycsIHtcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKicsXG4gICAgICAnQ29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgJ3gtYWNjZXNzLXRva2VuJzogdG9rZW4sXG4gICAgfSxcbiAgfSlcbiAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICBsZXQgcmVzdWx0ID0gJyc7XG4gICAgICBkYXRhLmRhdGEuZm9yRWFjaCgocGFydHkpID0+IHtcbiAgICAgICAgcmVzdWx0XG4gICAgICAgICAgICAgICAgKz0gYDxkaXYgY2xhc3M9XCJjb2wtMS1vZi0zXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmRcIj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmRfX3NpZGUgY2FyZF9fc2lkZS0tZnJvbnRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkX19waWN0dXJlIGNhcmRfX3BpY3R1cmUtLTFcIiBpZD1cInBhcnR5SW1hZ2VcIj4mbmJzcDs8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkX19kZXRhaWxzXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgc3R5bGU9XCJmb250LXNpemU6IDMwcHhcIiBjbGFzcz1cInBhcnR5SWRcIiBpZD0ke3BhcnR5LmlkfT4ke3BhcnR5Lm5hbWV9PC9saT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FyZF9fc2lkZSBjYXJkX19zaWRlLS1iYWNrIGNhcmRfX3NpZGUtLWJhY2stMVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNhcmRfX2N0YVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkX19wcmljZS1ib3hcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9XCJjYXJkX19wcmljZS1vbmx5XCI+SGVhZHF1YXRlciBBZGRyZXNzPC9wPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz1cImNhcmRfX3ByaWNlLW9ubHlcIiBpZD1cInBhcnR5QWRkcmVzc1wiPiR7cGFydHkuaHFhZGRyZXNzfTwvcD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPVwiI1wiIGNsYXNzPVwiYnRuXCIgaWQ9XCJlZGl0XCIgb25jbGljaz1cIm9wZW5FZGl0KCcke3BhcnR5LmlkfScpXCI+RWRpdDwvYT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPVwiI1wiIGNsYXNzPVwiYnRuXCIgaWQ9XCJkZWxldGVcIiBvbmNsaWNrPVwib3BlbkRlbGV0ZSgpXCI+RGVsZXRlPC9hPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+IGA7XG5cbiAgICAgICAgdXNlcm5hbWUgPSAgICAgICAgICAgICAgICBgPGxpPjxhIGhyZWY9XCIjXCIgY2xhc3M9XCJhY3RpdmVcIj4ke3BheWxvYWQudXNlck5hbWV9ICR7cGF5bG9hZC5sYXN0TmFtZX08L2E+PC9saT5gO1xuXG4gICAgICAgIG5hbWVzaWRlID0gICAgICAgICAgICAgICAgYDxzcGFuPiR7cGF5bG9hZC51c2VyTmFtZX0gJHtwYXlsb2FkLmxhc3ROYW1lfTwvc3Bhbj5gO1xuICAgICAgfSk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFydHlSZXN1bHQnKS5pbm5lckhUTUwgPSByZXN1bHQ7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlcm5hbWUnKS5pbm5lckhUTUwgPSB1c2VybmFtZTtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lc2lkZScpLmlubmVySFRNTCA9IG5hbWVzaWRlO1xuICAgIH0pO1xufVxuXG5nZXRQYXJ0aWVzKCk7XG5cbmZ1bmN0aW9uIG9wZW5FZGl0KHBhcnR5KSB7XG4gIG9wZW5QYXJ0eS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgb3BlblBhcnR5LmRhdGFzZXQucGFydHlJZCA9IHBhcnR5O1xuICBhZGRidG4uZGlzYWJsZWQgPSB0cnVlO1xufVxuXG5cbmZ1bmN0aW9uIGNsb3NlRWRpdCgpIHtcbiAgb3BlblBhcnR5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gIGRlbGV0ZUJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICBhZGRidG4uZGlzYWJsZWQgPSBmYWxzZTtcbn1cbmxldCByZXNwb25zZVN0YXR1cyA9IGZhbHNlO1xuY29uc3QgcmVzdWx0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdCcpO1xuXG5mdW5jdGlvbiBlZGl0U3VibWl0KCkge1xuICBjb25zdCBJZCA9IG9wZW5QYXJ0eS5kYXRhc2V0LnBhcnR5SWQ7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZWRpdHZhbHVlJykudmFsdWU7XG5cbiAgZmV0Y2goYGh0dHBzOi8vdHJ1c3Rwb2xpdGljby5oZXJva3VhcHAuY29tL2FwaS92MS9wYXJ0aWVzLyR7SWR9L25hbWVgLCB7XG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKicsXG4gICAgICAnQ29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgJ3gtYWNjZXNzLXRva2VuJzogdG9rZW4sXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBuYW1lLFxuICAgIH0pLFxuXG4gIH0pXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXNwb25zZVN0YXR1cyA9IHRydWU7XG4gICAgICAgIGRlbFJlc3VsdC5pbm5lckhUTUwgPSAnQ2FuZGlkYXRlIG5hbWUgaGFkIGNoYW5nZWQnO1xuICAgICAgICBkZWxSZXN1bHQuc3R5bGUuY29sb3IgPSAnd2hpdGUnO1xuICAgICAgICBjbG9zZUVkaXQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH0pXG4gICAgLy8gcmVuZGVyIHRoZSBwYXJ0aWVzIHBhZ2VcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgaWYgKCFyZXNwb25zZVN0YXR1cykge1xuICAgICAgICBkZWxSZXN1bHQuaW5uZXJIVE1MID0gcmVzLmVycm9yO1xuICAgICAgICBkZWxSZXN1bHQuc3R5bGUuY29sb3IgPSAncmVkJztcbiAgICAgIH1cbiAgICAgIGlmIChwYXlsb2FkLmlzYWRtaW4gPT0gZmFsc2UpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3ZpZXdzL3NpZ25pbi5odG1sJztcbiAgICAgIH1cbiAgICB9KTtcbn1cblxuLy8gZGVsZXRlIHBhcnR5XG5sZXQgZGVsUmVzdWx0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbFJlc3VsdCcpO1xuXG5mdW5jdGlvbiBkZWxldGVHbygpIHtcbiAgY29uc3QgSWQgPSBvcGVuUGFydHkuZGF0YXNldC5wYXJ0eUlkO1xuXG4gIGZldGNoKGBodHRwczovL3RydXN0cG9saXRpY28uaGVyb2t1YXBwLmNvbS9hcGkvdjEvcGFydGllcy8ke0lkfWAsIHtcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKicsXG4gICAgICAnQ29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgJ3gtYWNjZXNzLXRva2VuJzogdG9rZW4sXG4gICAgfSxcbiAgfSlcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJlc3BvbnNlU3RhdHVzID0gdHJ1ZTtcbiAgICAgICAgcmVzdWx0LmlubmVySFRNTCA9ICdDYW5kaWRhdGUgbmFtZSBoYWQgY2hhbmdlZCc7XG4gICAgICAgIHJlc3VsdC5zdHlsZS5jb2xvciA9ICdncmVlbic7XG4gICAgICAgIGNsb3NlRWRpdCgpO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH0pXG4gICAgLy8gcmVuZGVyIHRoZSBwYXJ0aWVzIHBhZ2VcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgaWYgKCFyZXNwb25zZVN0YXR1cykge1xuICAgICAgICByZXN1bHQuaW5uZXJIVE1MID0gcmVzLmVycm9yO1xuICAgICAgICByZXN1bHQuc3R5bGUuY29sb3IgPSAncmVkJztcbiAgICAgIH1cbiAgICAgIGlmIChwYXlsb2FkLmlzYWRtaW4gPT0gZmFsc2UpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3ZpZXdzL3NpZ25pbi5odG1sJztcbiAgICAgIH1cbiAgICB9KTtcbn1cbiJdfQ==